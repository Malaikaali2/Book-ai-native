"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_book=globalThis.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[4265],{149(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>_,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"module-1-ros/advanced-topics","title":"Advanced ROS 2 Topics: Services, Actions, and Parameters","description":"Overview","source":"@site/docs/module-1-ros/advanced-topics.md","sourceDirName":"module-1-ros","slug":"/module-1-ros/advanced-topics","permalink":"/Book-ai-native/docs/module-1-ros/advanced-topics","draft":false,"unlisted":false,"editUrl":"https://github.com/Malaikaali2/Book-ai-native/tree/main/docs/module-1-ros/advanced-topics.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Hands-on Lab: Publisher/Subscriber Nodes","permalink":"/Book-ai-native/docs/module-1-ros/lab-publisher-subscriber"},"next":{"title":"Navigation Stack Integration","permalink":"/Book-ai-native/docs/module-1-ros/navigation-integration"}}');var a=r(4848),s=r(8453);const t={sidebar_position:4},l="Advanced ROS 2 Topics: Services, Actions, and Parameters",c={},o=[{value:"Overview",id:"overview",level:2},{value:"Services",id:"services",level:2},{value:"Service Definition",id:"service-definition",level:3},{value:"Creating a Service Server",id:"creating-a-service-server",level:3},{value:"Creating a Service Client",id:"creating-a-service-client",level:3},{value:"Actions",id:"actions",level:2},{value:"Action Definition",id:"action-definition",level:3},{value:"Creating an Action Server",id:"creating-an-action-server",level:3},{value:"Creating an Action Client",id:"creating-an-action-client",level:3},{value:"Parameter System",id:"parameter-system",level:2},{value:"Declaring and Using Parameters",id:"declaring-and-using-parameters",level:3},{value:"Setting Parameters at Launch",id:"setting-parameters-at-launch",level:3},{value:"Quality of Service (QoS) Settings",id:"quality-of-service-qos-settings",level:2},{value:"Lifecycle Nodes",id:"lifecycle-nodes",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"References",id:"references",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"advanced-ros-2-topics-services-actions-and-parameters",children:"Advanced ROS 2 Topics: Services, Actions, and Parameters"})}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"This section covers advanced ROS 2 communication patterns and system configuration mechanisms. We'll explore services for synchronous request-response communication, actions for long-running tasks with feedback, and the parameter system for runtime configuration."}),"\n",(0,a.jsx)(n.h2,{id:"services",children:"Services"}),"\n",(0,a.jsx)(n.p,{children:"Services provide synchronous, request-response communication between nodes. Unlike topics which use a publish-subscribe model, services establish a direct connection between a client and a server for each request."}),"\n",(0,a.jsx)(n.h3,{id:"service-definition",children:"Service Definition"}),"\n",(0,a.jsxs)(n.p,{children:["Services are defined using ",(0,a.jsx)(n.code,{children:".srv"})," files that specify both request and response message types. Here's an example service definition:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["File: ",(0,a.jsx)(n.code,{children:"example_interfaces/srv/AddTwoInts.srv"})]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"# Request\r\nint64 a\r\nint64 b\r\n---\r\n# Response\r\nint64 sum\n"})}),"\n",(0,a.jsx)(n.h3,{id:"creating-a-service-server",children:"Creating a Service Server"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\nclass MinimalService(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('minimal_service')\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(f'Returning {request.a} + {request.b} = {response.sum}')\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_service = MinimalService()\r\n\r\n    try:\r\n        rclpy.spin(minimal_service)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        minimal_service.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,a.jsx)(n.h3,{id:"creating-a-service-client",children:"Creating a Service Client"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\nclass MinimalClient(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('minimal_client')\r\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\r\n\r\n        # Wait for service to be available\r\n        while not self.cli.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Service not available, waiting again...')\r\n\r\n    def send_request(self, a, b):\r\n        request = AddTwoInts.Request()\r\n        request.a = a\r\n        request.b = b\r\n        self.future = self.cli.call_async(request)\r\n        return self.future\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_client = MinimalClient()\r\n\r\n    # Send request\r\n    future = minimal_client.send_request(1, 2)\r\n\r\n    try:\r\n        rclpy.spin_until_future_complete(minimal_client, future)\r\n        response = future.result()\r\n        minimal_client.get_logger().info(f'Result: {response.sum}')\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        minimal_client.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"actions",children:"Actions"}),"\n",(0,a.jsx)(n.p,{children:"Actions are designed for long-running tasks that require feedback and the ability to cancel. They combine features of both topics and services."}),"\n",(0,a.jsx)(n.h3,{id:"action-definition",children:"Action Definition"}),"\n",(0,a.jsxs)(n.p,{children:["Actions are defined using ",(0,a.jsx)(n.code,{children:".action"})," files:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["File: ",(0,a.jsx)(n.code,{children:"example_interfaces/action/Fibonacci.action"})]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"# Goal\r\nint32 order\r\n---\r\n# Result\r\nint32[] sequence\r\n---\r\n# Feedback\r\nint32[] sequence\n"})}),"\n",(0,a.jsx)(n.h3,{id:"creating-an-action-server",children:"Creating an Action Server"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.action import ActionServer\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\nclass MinimalActionServer(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('minimal_action_server')\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci',\r\n            self.execute_callback)\r\n\r\n    def execute_callback(self, goal_handle):\r\n        self.get_logger().info(f'Executing goal: {goal_handle.request.order}')\r\n\r\n        feedback_msg = Fibonacci.Feedback()\r\n        feedback_msg.sequence = [0, 1]\r\n\r\n        for i in range(1, goal_handle.request.order):\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info('Goal canceled')\r\n                return Fibonacci.Result()\r\n\r\n            feedback_msg.sequence.append(\r\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\r\n\r\n            self.get_logger().info(f'Publishing feedback: {feedback_msg.sequence}')\r\n            goal_handle.publish_feedback(feedback_msg)\r\n\r\n        goal_handle.succeed()\r\n        result = Fibonacci.Result()\r\n        result.sequence = feedback_msg.sequence\r\n        return result\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_action_server = MinimalActionServer()\r\n\r\n    try:\r\n        rclpy.spin(minimal_action_server)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        minimal_action_server.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,a.jsx)(n.h3,{id:"creating-an-action-client",children:"Creating an Action Client"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.action import ActionClient\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\nclass MinimalActionClient(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('minimal_action_client')\r\n        self._action_client = ActionClient(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci')\r\n\r\n    def send_goal(self, order):\r\n        goal_msg = Fibonacci.Goal()\r\n        goal_msg.order = order\r\n\r\n        self._action_client.wait_for_server()\r\n        self._send_goal_future = self._action_client.send_goal_async(\r\n            goal_msg,\r\n            feedback_callback=self.feedback_callback)\r\n\r\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\r\n\r\n    def goal_response_callback(self, future):\r\n        goal_handle = future.result()\r\n        if not goal_handle.accepted:\r\n            self.get_logger().info('Goal rejected')\r\n            return\r\n\r\n        self.get_logger().info('Goal accepted')\r\n        self._get_result_future = goal_handle.get_result_async()\r\n        self._get_result_future.add_done_callback(self.get_result_callback)\r\n\r\n    def feedback_callback(self, feedback_msg):\r\n        feedback = feedback_msg.feedback\r\n        self.get_logger().info(f'Received feedback: {feedback.sequence}')\r\n\r\n    def get_result_callback(self, future):\r\n        result = future.result().result\r\n        self.get_logger().info(f'Result: {result.sequence}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_action_client = MinimalActionClient()\r\n\r\n    minimal_action_client.send_goal(10)\r\n\r\n    try:\r\n        rclpy.spin(minimal_action_client)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        minimal_action_client.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"parameter-system",children:"Parameter System"}),"\n",(0,a.jsx)(n.p,{children:"The parameter system allows nodes to be configured at runtime. Parameters can be declared, set, and modified dynamically."}),"\n",(0,a.jsx)(n.h3,{id:"declaring-and-using-parameters",children:"Declaring and Using Parameters"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass ParameterNode(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('parameter_node')\r\n\r\n        # Declare parameters with default values\r\n        self.declare_parameter('my_int_param', 42)\r\n        self.declare_parameter('my_string_param', 'default_value')\r\n        self.declare_parameter('my_double_param', 3.14)\r\n\r\n        # Get parameter values\r\n        my_int = self.get_parameter('my_int_param').value\r\n        my_string = self.get_parameter('my_string_param').value\r\n        my_double = self.get_parameter('my_double_param').value\r\n\r\n        self.get_logger().info(f'Int: {my_int}, String: {my_string}, Double: {my_double}')\r\n\r\n        # Set a callback for parameter changes\r\n        self.add_on_set_parameters_callback(self.parameter_callback)\r\n\r\n    def parameter_callback(self, params):\r\n        for param in params:\r\n            self.get_logger().info(f'Parameter {param.name} changed to {param.value}')\r\n        return SetParametersResult(successful=True)\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    parameter_node = ParameterNode()\r\n\r\n    try:\r\n        rclpy.spin(parameter_node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        parameter_node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,a.jsx)(n.h3,{id:"setting-parameters-at-launch",children:"Setting Parameters at Launch"}),"\n",(0,a.jsx)(n.p,{children:"Parameters can be set in launch files:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from launch import LaunchDescription\r\nfrom launch_ros.actions import Node\r\n\r\ndef generate_launch_description():\r\n    return LaunchDescription([\r\n        Node(\r\n            package='my_package',\r\n            executable='parameter_node',\r\n            name='parameter_node',\r\n            parameters=[\r\n                {'my_int_param': 100},\r\n                {'my_string_param': 'configured_value'},\r\n                {'my_double_param': 2.71},\r\n            ]\r\n        )\r\n    ])\n"})}),"\n",(0,a.jsx)(n.h2,{id:"quality-of-service-qos-settings",children:"Quality of Service (QoS) Settings"}),"\n",(0,a.jsx)(n.p,{children:"QoS settings allow fine-tuning of communication behavior to match application requirements:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, QoSDurabilityPolicy, QoSHistoryPolicy, QoSReliabilityPolicy\r\n\r\n# Create a QoS profile\r\nqos_profile = QoSProfile(\r\n    depth=10,\r\n    durability=QoSDurabilityPolicy.TRANSIENT_LOCAL,  # Keep messages for late-joining subscribers\r\n    history=QoSHistoryPolicy.KEEP_LAST,  # Keep only the last N messages\r\n    reliability=QoSReliabilityPolicy.RELIABLE  # Ensure all messages are delivered\r\n)\r\n\r\n# Use the QoS profile when creating a publisher\r\npublisher = node.create_publisher(String, 'topic', qos_profile)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"lifecycle-nodes",children:"Lifecycle Nodes"}),"\n",(0,a.jsx)(n.p,{children:"Lifecycle nodes provide a more controlled way to manage node states (unconfigured, inactive, active, finalized):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from rclpy.lifecycle import LifecycleNode\r\nfrom rclpy.lifecycle import TransitionCallbackReturn\r\n\r\nclass LifecycleNodeExample(LifecycleNode):\r\n\r\n    def __init__(self):\r\n        super().__init__('lifecycle_node')\r\n\r\n    def on_configure(self, state):\r\n        self.get_logger().info(f'Configuring node from state {state}')\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_activate(self, state):\r\n        self.get_logger().info(f'Activating node from state {state}')\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_deactivate(self, state):\r\n        self.get_logger().info(f'Deactivating node from state {state}')\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_cleanup(self, state):\r\n        self.get_logger().info(f'Cleaning up node from state {state}')\r\n        return TransitionCallbackReturn.SUCCESS\n"})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use services"})," for operations that should return a result immediately"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use actions"})," for long-running operations that need feedback or cancellation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use topics"})," for continuous data streams and event notifications"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Parameter validation"}),": Always validate parameter values before using them"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"QoS matching"}),": Ensure publishers and subscribers have compatible QoS settings"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Resource cleanup"}),": Always clean up resources in node destruction"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,a.jsx)(n.p,{children:"[All sources will be cited in the References section at the end of the book, following APA format]"})]})}function _(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>l});var i=r(6540);const a={},s=i.createContext(a);function t(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);